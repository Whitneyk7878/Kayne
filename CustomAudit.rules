# EXPIREMENTAL
# PLACE INTO
# /etc/audit/audit.rules
#
#
# Created  : 02/20/2025
#
# Based on rules published here:
#   https://attack.mitre.org/tactics/enterprise/

# Remove any existing rules
-D

# Buffer Size
## Feel free to increase this if the machine panic's
-b 8192

# Failure Mode
## Possible values: 0 (silent), 1 (printk, print a failure message), 2 (panic, halt the system)
-f 1

# Ignore errors
## e.g. caused by users or files not found in the local environment
-i
# NOTES: when auid is set to >=1000 that means it is monitoring for all non root users.
# If you dont have root users you need to change it to auid=0


#//////////////////////////////////////////////////////////////////////////////////////////////////////
# TA0002 EXECUTION
#//////////////////////////////////////////////////////////////////////////////////////////////////////

#///////////////////////////////////////////////////
# T1059 - Command and Scripting Interpreter Execution
#///////////////////////////////////////////////////

# Monitor shell execution
-a always,exit -F arch=b64 -S execve -F path=/bin/sh -F key=TA0002_T1059_shell
-a always,exit -F arch=b64 -S execve -F path=/bin/bash -F key=TA0002_T1059_shell
-a always,exit -F arch=b64 -S execve -F path=/bin/zsh -F key=TA0002_T1059_shell

# Monitor scripting languages
-a always,exit -F arch=b64 -S execve -F path=/usr/bin/python3 -F key=TA0002_T1059_python3
-a always,exit -F arch=b64 -S execve -F path=/usr/bin/python -F key=TA0002_T1059_python
-a always,exit -F arch=b64 -S execve -F path=/usr/bin/node -F key=TA0002_T1059_javascript
-a always,exit -F arch=b64 -S execve -F path=/usr/bin/lua -F key=TA0002_T1059_lua
-a always,exit -F arch=b64 -S execve -F path=/usr/bin/ruby -F key=TA0002_T1059_ruby
-a always,exit -F arch=b64 -S execve -F path=/usr/bin/perl -F key=TA0002_T1059_perl
-a always,exit -F arch=b64 -S execve -F path=/usr/bin/node -F key=TA0002_T1059_nodejs
-a always,exit -F arch=b64 -S execve -F path=/usr/bin/fish -F key=TA0002_T1059_fish

#///////////////////////////////////////////////////
# T1053 - Scheduled Task/Job Executionn
#///////////////////////////////////////////////////

# Monitor 'at' command execution
-a always,exit -F arch=b64 -S execve -F path=/usr/bin/at -F key=TA0002_T1053_at
-a always,exit -F arch=b32 -S execve -F path=/usr/bin/at -F key=TA0002_T1053_at

# Monitor cron job modifications
-w /etc/cron.d/ -p wa -k TA0002_T1053_cron
-w /etc/cron.daily/ -p wa -k TA0002_T1053_cron
-w /etc/cron.hourly/ -p wa -k TA0002_T1053_cron
-w /etc/cron.weekly/ -p wa -k TA0002_T1053_cron
-w /etc/cron.monthly/ -p wa -k TA0002_T1053_cron
-w /etc/crontab -p wa -k TA0002_T1053_cron

# Monitor systemd timer changes
-w /etc/systemd/system/ -p wa -k TA0002_T1053_systemd
-w /usr/lib/systemd/system/ -p wa -k TA0002_T1053_systemd
-w /var/spool/cron/ -p wa -k TA0002_T1053_cron

#///////////////////////////////////////////////////
# T1609 - Container Administration Commands
#///////////////////////////////////////////////////

# Monitor Docker commands
-a always,exit -F arch=b64 -S execve -F path=/usr/bin/docker -F key=TA0002_T1609_docker
-a always,exit -F arch=b64 -S execve -F path=/usr/bin/dockerd -F key=TA0002_T1609_docker
-a always,exit -F arch=b64 -S execve -F path=/usr/local/bin/docker -F key=TA0002_T1609_docker

# Monitor Kubernetes commands
-a always,exit -F arch=b64 -S execve -F path=/usr/bin/kubectl -F key=TA0002_T1609_kubernetes
-a always,exit -F arch=b64 -S execve -F path=/usr/local/bin/kubectl -F key=TA0002_T1609_kubernetes
-a always,exit -F arch=b64 -S execve -F path=/usr/bin/kubeadm -F key=TA0002_T1609_kubernetes
-a always,exit -F arch=b64 -S execve -F path=/usr/bin/kubelet -F key=TA0002_T1609_kubernetes




